<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="refresh" content="60">
  <title>System Status | Domain Monitor</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0f1117; --surface: #1a1d2e; --border: #2a2d3e;
      --text: #e2e8f0; --text-muted: #8892a4; --accent: #6366f1;
      --green: #22c55e; --yellow: #f59e0b; --red: #ef4444;
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
    .container { max-width: 860px; margin: 0 auto; padding: 40px 20px; }
    header { text-align: center; margin-bottom: 48px; }
    header h1 { font-size: 28px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 12px; }
    header img { width: 36px; height: 36px; }
    header p { color: var(--text-muted); margin-top: 8px; font-size: 14px; }
    .status-banner { border-radius: 12px; padding: 24px 32px; margin-bottom: 32px; display: flex; align-items: center; gap: 20px; }
    .status-banner.operational { background: rgba(34, 197, 94, 0.12); border: 1px solid rgba(34, 197, 94, 0.3); }
    .status-banner.warning { background: rgba(245, 158, 11, 0.12); border: 1px solid rgba(245, 158, 11, 0.3); }
    .status-banner.degraded { background: rgba(239, 68, 68, 0.12); border: 1px solid rgba(239, 68, 68, 0.3); }
    .status-icon { font-size: 36px; }
    .status-banner.operational .status-icon { color: var(--green); }
    .status-banner.warning .status-icon { color: var(--yellow); }
    .status-banner.degraded .status-icon { color: var(--red); }
    .status-text h2 { font-size: 22px; font-weight: 600; }
    .status-text p { color: var(--text-muted); margin-top: 4px; font-size: 14px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center; }
    .stat-value { font-size: 32px; font-weight: 700; }
    .stat-label { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
    .stat-value.green { color: var(--green); }
    .stat-value.yellow { color: var(--yellow); }
    .stat-value.red { color: var(--red); }
    .section { margin-bottom: 32px; }
    .section h3 { font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .group-item { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .group-info { display: flex; align-items: center; gap: 12px; }
    .group-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .group-name { font-weight: 500; }
    .group-count { font-size: 13px; color: var(--text-muted); margin-top: 2px; }
    .group-status { font-size: 13px; font-weight: 600; padding: 4px 10px; border-radius: 20px; }
    .group-status.operational { background: rgba(34,197,94,0.15); color: var(--green); }
    .group-status.warning { background: rgba(245,158,11,0.15); color: var(--yellow); }
    .group-status.degraded { background: rgba(239,68,68,0.15); color: var(--red); }
    .footer { text-align: center; color: var(--text-muted); font-size: 13px; margin-top: 48px; padding-top: 24px; border-top: 1px solid var(--border); }
    .loading { text-align: center; padding: 80px; color: var(--text-muted); }
    .uptime-bar { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 32px; }
    .uptime-pct { font-size: 36px; font-weight: 700; color: var(--green); }
    .uptime-label { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
    .uptime-meta { font-size: 13px; color: var(--text-muted); margin-top: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><img src="favicon.png" alt=""> System Status</h1>
      <p>Live status of all monitored domains</p>
    </header>

    <div id="statusContent" class="loading">
      <i class="fa-solid fa-circle-notch fa-spin" style="font-size:32px;"></i>
      <p style="margin-top:16px;">Loading status...</p>
    </div>
  </div>

  <script>
    async function loadStatus() {
      try {
        var res = await fetch('/api/status');
        if (!res.ok) throw new Error('Failed to load status');
        var data = await res.json();

        var statusLabels = {
          operational: 'All Systems Operational',
          warning: 'Some Systems Need Attention',
          degraded: 'Service Disruption',
        };
        var statusIcons = {
          operational: 'fa-circle-check',
          warning: 'fa-triangle-exclamation',
          degraded: 'fa-circle-xmark',
        };

        var groupsHtml = (data.groups && data.groups.length > 0) ? data.groups.map(function(g) {
          return '<div class="group-item">' +
            '<div class="group-info">' +
              '<div class="group-dot" style="background:' + g.color + '"></div>' +
              '<div>' +
                '<div class="group-name">' + escHtml(g.name) + '</div>' +
                '<div class="group-count">' + g.domains + ' domain' + (g.domains !== 1 ? 's' : '') + '</div>' +
              '</div>' +
            '</div>' +
            '<span class="group-status ' + g.status + '">' + g.status.charAt(0).toUpperCase() + g.status.slice(1) + '</span>' +
          '</div>';
        }).join('') : '<p style="color:var(--text-muted);font-size:14px;">No groups configured.</p>';

        var uptimePct = data.uptime_24h.uptime_pct;
        var uptimeHtml = uptimePct !== null ? (
          '<div class="uptime-bar">' +
            '<div class="uptime-pct">' + uptimePct + '%</div>' +
            '<div class="uptime-label">Uptime (last 24h)</div>' +
            (data.uptime_24h.avg_response_time_ms ? '<div class="uptime-meta">Avg response: ' + data.uptime_24h.avg_response_time_ms + 'ms &bull; ' + data.uptime_24h.total_checks + ' checks</div>' : '') +
          '</div>'
        ) : '';

        var ts = new Date(data.timestamp).toLocaleString();

        document.getElementById('statusContent').innerHTML =
          '<div class="status-banner ' + data.status + '">' +
            '<div class="status-icon"><i class="fa-solid ' + statusIcons[data.status] + '"></i></div>' +
            '<div class="status-text">' +
              '<h2>' + statusLabels[data.status] + '</h2>' +
              '<p>Last updated: ' + ts + '</p>' +
            '</div>' +
          '</div>' +
          '<div class="stats-grid">' +
            '<div class="stat-card"><div class="stat-value">' + data.summary.total_domains + '</div><div class="stat-label">Total Domains</div></div>' +
            '<div class="stat-card"><div class="stat-value green">' + data.summary.healthy + '</div><div class="stat-label">Healthy</div></div>' +
            '<div class="stat-card"><div class="stat-value ' + (data.summary.expiring_soon > 0 ? 'yellow' : '') + '">' + data.summary.expiring_soon + '</div><div class="stat-label">Expiring Soon</div></div>' +
            '<div class="stat-card"><div class="stat-value ' + (data.summary.expired > 0 ? 'red' : '') + '">' + data.summary.expired + '</div><div class="stat-label">Expired</div></div>' +
            '<div class="stat-card"><div class="stat-value ' + (data.summary.errors > 0 ? 'red' : '') + '">' + data.summary.errors + '</div><div class="stat-label">Errors</div></div>' +
          '</div>' +
          uptimeHtml +
          (data.groups.length > 0 ?
            '<div class="section"><h3>Groups</h3>' + groupsHtml + '</div>'
          : '') +
          '<div class="footer">' +
            '<p>Powered by Domain Monitor &bull; Auto-refreshes every 60 seconds &bull; <a href="/" style="color:var(--accent);text-decoration:none;">Go to Dashboard</a></p>' +
          '</div>';

      } catch (err) {
        document.getElementById('statusContent').innerHTML =
          '<div class="status-banner degraded">' +
            '<div class="status-icon"><i class="fa-solid fa-circle-xmark"></i></div>' +
            '<div class="status-text">' +
              '<h2>Unable to load status</h2>' +
              '<p>The status service is currently unavailable.</p>' +
            '</div>' +
          '</div>';
      }
    }

    function escHtml(str) {
      var div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    loadStatus();
  </script>
</body>
</html>
